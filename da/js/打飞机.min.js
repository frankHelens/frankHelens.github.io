var canvas=document.getElementById("plane");canvas.width=document.documentElement.clientWidth;canvas.height=document.documentElement.clientHeight;function rnd(min,max){return Math.round(Math.random()*(max-min)+min)}function ye(event){heroFly.x=event.changedTouches[0].clientX-heroFly.img.width/5/320*canvas.width/2;heroFly.y=event.changedTouches[0].clientY-heroFly.img.height/568*canvas.height/2}var heroFly=null;var bol=false;var dan=1;var plane=canvas.getContext("2d");var bgheight=0;var imgarr=["img/bg.png","img/enemy1_fly.png","img/enemy2_fly.png","img/enemy3_fly.png","img/hero_fly.png","img/bullet1.png","img/game_pause.png","img/bomb.png","img/gift.png"];var storp=new Image();storp.src="img/game_pause.png";var gi=new Image();gi.src="img/gift.png";var bomb=new Image();bomb.src="img/bomb.png";var bombt=003;var fen=0;var images=0;for(var i=0;i<imgarr.length;i+=1){var img=new Image();img.src=imgarr[i];img.onload=function(){images+=1;if(images==imgarr.length){heroFly=new hero_fly();ye123=new gift();game()}}}var num=0;var can=1;var dan=500;var badfly=[];var bullet12=[];var gift0=[];var ye123=null;function game(){num+=1;dan+=1;plane.clearRect(0,0,canvas.width,canvas.height);bgheight+=2;if(bgheight>=canvas.height){bgheight=0}bg();for(var i=0;i<badfly.length;i+=1){for(var j=0;j<bullet12.length;j+=1){if(bullet12[j].x>=badfly[i].x&&bullet12[j].x+bullet12[j].img.width/320*canvas.width<=badfly[i].x+badfly[i].img.width/badfly[i].die/320*canvas.width&&bullet12[j].y+bullet12[j].img.height/568*canvas.height<=badfly[i].y+badfly[i].img.height/568*canvas.height&&bullet12[j].y>=badfly[i].y){if(badfly[i].HP>0){bullet12.splice(j,1);fen+=100}badfly[i].HP-=1;break}}}if(num%15==0){if(can==1){if(dan<=500){var bullet0=new bullet();var bullet01=new bullet();bullet0.img=bullet2;bullet01.img=bullet2;bullet0.x=heroFly.x+10/320*canvas.width;bullet01.x=heroFly.x+52/320*canvas.width;bullet12.push(bullet0);bullet12.push(bullet01)}else{var bullet0=new bullet();bullet12.push(bullet0)}}}for(var i=0;i<bullet12.length;i+=1){bullet12[i].y-=canvas.height/100;bullet12[i].draw();if(bullet12[i].y<=0){bullet12.splice(i,1)}}if(num%30==0){if(can==1){var bad=new enemy_fly();badfly.push(bad)}}for(var i=0;i<badfly.length;i+=1){badfly[i].y+=badfly[i].speed;if(badfly[i].y>=canvas.height){badfly.splice(i,1)}}for(var i=0;i<badfly.length;i+=1){if(badfly[i].HP<=0){badfly[i].y-=badfly[i].speed;if(num%5==0){badfly[i].b+=1;if(badfly[i].b==badfly[i].die-1){if(badfly[i].index==0){fen+=100}else if(badfly[i].index==0){fen+=300}else{fen+=500}badfly.splice(i,1)}}}}for(var i=0;i<badfly.length;i+=1){if(badfly[i].die==5){plane.beginPath();plane.moveTo(badfly[i].x+9/320*canvas.width,badfly[i].y+1/568*canvas.height);plane.lineTo(badfly[i].x+26/320*canvas.width,badfly[i].y+1/568*canvas.height);plane.lineTo(badfly[i].x+26/320*canvas.width,badfly[i].y+6/568*canvas.height);plane.lineTo(badfly[i].x+31/320*canvas.width,badfly[i].y+6/568*canvas.height);plane.lineTo(badfly[i].x+34/320*canvas.width,badfly[i].y+9.5/568*canvas.height);plane.lineTo(badfly[i].x+19/320*canvas.width,badfly[i].y+24/568*canvas.height);plane.lineTo(badfly[i].x+15/320*canvas.width,badfly[i].y+24/568*canvas.height);plane.lineTo(badfly[i].x+2/320*canvas.width,badfly[i].y+11/568*canvas.height);plane.lineTo(badfly[i].x+2/320*canvas.width,badfly[i].y+7/568*canvas.height);plane.lineTo(badfly[i].x+9/320*canvas.width,badfly[i].y+7/568*canvas.height);plane.closePath()}else if(badfly[i].die==6){plane.beginPath();plane.moveTo(badfly[i].x+20/320*canvas.width,badfly[i].y+1/568*canvas.height);plane.lineTo(badfly[i].x+26/320*canvas.width,badfly[i].y+1/568*canvas.height);plane.lineTo(badfly[i].x+28/320*canvas.width,badfly[i].y+6/568*canvas.height);plane.lineTo(badfly[i].x+31/320*canvas.width,badfly[i].y+6/568*canvas.height);plane.lineTo(badfly[i].x+31/320*canvas.width,badfly[i].y+16/568*canvas.height);plane.lineTo(badfly[i].x+35/320*canvas.width,badfly[i].y+18/568*canvas.height);plane.lineTo(badfly[i].x+35/320*canvas.width,badfly[i].y+20/568*canvas.height);plane.lineTo(badfly[i].x+45/320*canvas.width,badfly[i].y+20/568*canvas.height);plane.lineTo(badfly[i].x+45/320*canvas.width,badfly[i].y+41/568*canvas.height);plane.lineTo(badfly[i].x+40/320*canvas.width,badfly[i].y+41/568*canvas.height);plane.lineTo(badfly[i].x+33/320*canvas.width,badfly[i].y+46/568*canvas.height);plane.lineTo(badfly[i].x+28/320*canvas.width,badfly[i].y+58/568*canvas.height);plane.lineTo(badfly[i].x+18/320*canvas.width,badfly[i].y+58/568*canvas.height);plane.lineTo(badfly[i].x+12/320*canvas.width,badfly[i].y+45/568*canvas.height);plane.lineTo(badfly[i].x+6/320*canvas.width,badfly[i].y+41/568*canvas.height);plane.lineTo(badfly[i].x+1/320*canvas.width,badfly[i].y+41/568*canvas.height);plane.lineTo(badfly[i].x+1/320*canvas.width,badfly[i].y+20/568*canvas.height);plane.lineTo(badfly[i].x+11/320*canvas.width,badfly[i].y+20/568*canvas.height);plane.lineTo(badfly[i].x+11/320*canvas.width,badfly[i].y+18/568*canvas.height);plane.lineTo(badfly[i].x+14/320*canvas.width,badfly[i].y+18/568*canvas.height);plane.lineTo(badfly[i].x+14/320*canvas.width,badfly[i].y+16/568*canvas.height);plane.lineTo(badfly[i].x+15/320*canvas.width,badfly[i].y+16/568*canvas.height);plane.lineTo(badfly[i].x+15/320*canvas.width,badfly[i].y+6/568*canvas.height);plane.lineTo(badfly[i].x+19/320*canvas.width,badfly[i].y+6/568*canvas.height);plane.lineTo(badfly[i].x+19/320*canvas.width,badfly[i].y+4/568*canvas.height);plane.closePath()}else{plane.beginPath();plane.moveTo(badfly[i].x+8/320*canvas.width,badfly[i].y);plane.lineTo(badfly[i].x+16/320*canvas.width,badfly[i].y);plane.lineTo(badfly[i].x+17/320*canvas.width,badfly[i].y+2/568*canvas.height);plane.lineTo(badfly[i].x+17/320*canvas.width,badfly[i].y+33/568*canvas.height);plane.lineTo(badfly[i].x+27/320*canvas.width,badfly[i].y+43/568*canvas.height);plane.lineTo(badfly[i].x+41/320*canvas.width,badfly[i].y+49/568*canvas.height);plane.lineTo(badfly[i].x+45/320*canvas.width,badfly[i].y+49/568*canvas.height);plane.lineTo(badfly[i].x+47/320*canvas.width,badfly[i].y+44/568*canvas.height);plane.lineTo(badfly[i].x+59/320*canvas.width,badfly[i].y+44/568*canvas.height);plane.lineTo(badfly[i].x+61/320*canvas.width,badfly[i].y+49/568*canvas.height);plane.lineTo(badfly[i].x+69/320*canvas.width,badfly[i].y+49/568*canvas.height);plane.lineTo(badfly[i].x+77/320*canvas.width,badfly[i].y+49/568*canvas.height);plane.lineTo(badfly[i].x+89/320*canvas.width,badfly[i].y+34/568*canvas.height);plane.lineTo(badfly[i].x+89/320*canvas.width,badfly[i].y);plane.lineTo(badfly[i].x+98/320*canvas.width,badfly[i].y);plane.lineTo(badfly[i].x+98/320*canvas.width,badfly[i].y+66/568*canvas.height);plane.lineTo(badfly[i].x+100/320*canvas.width,badfly[i].y+67/568*canvas.height);plane.lineTo(badfly[i].x+100/320*canvas.width,badfly[i].y+70/568*canvas.height);plane.lineTo(badfly[i].x+98/320*canvas.width,badfly[i].y+74/568*canvas.height);plane.lineTo(badfly[i].x+89/320*canvas.width,badfly[i].y+74/568*canvas.height);plane.lineTo(badfly[i].x+94/320*canvas.width,badfly[i].y+86/568*canvas.height);plane.lineTo(badfly[i].x+94/320*canvas.width,badfly[i].y+111/568*canvas.height);plane.lineTo(badfly[i].x+107/320*canvas.width,badfly[i].y+122/568*canvas.height);plane.lineTo(badfly[i].x+107/320*canvas.width,badfly[i].y+132/568*canvas.height);plane.lineTo(badfly[i].x+79/320*canvas.width,badfly[i].y+159/568*canvas.height);plane.lineTo(badfly[i].x+68/320*canvas.width,badfly[i].y+159/568*canvas.height);plane.lineTo(badfly[i].x+63/320*canvas.width,badfly[i].y+163/568*canvas.height);plane.lineTo(badfly[i].x+41/320*canvas.width,badfly[i].y+163/568*canvas.height);plane.lineTo(badfly[i].x+39/320*canvas.width,badfly[i].y+159/568*canvas.height);plane.lineTo(badfly[i].x+29/320*canvas.width,badfly[i].y+159/568*canvas.height);plane.lineTo(badfly[i].x,badfly[i].y+132/568*canvas.height);plane.lineTo(badfly[i].x,badfly[i].y+122/568*canvas.height);plane.lineTo(badfly[i].x+12/320*canvas.width,badfly[i].y+111/568*canvas.height);plane.lineTo(badfly[i].x+12/320*canvas.width,badfly[i].y+86/568*canvas.height);plane.lineTo(badfly[i].x+17/320*canvas.width,badfly[i].y+74/568*canvas.height);plane.lineTo(badfly[i].x+9/320*canvas.width,badfly[i].y+74/568*canvas.height);plane.lineTo(badfly[i].x+7/320*canvas.width,badfly[i].y+70/568*canvas.height);plane.lineTo(badfly[i].x+7/320*canvas.width,badfly[i].y+67/568*canvas.height);plane.lineTo(badfly[i].x+8/320*canvas.width,badfly[i].y+67/568*canvas.height);plane.closePath()}if(plane.isPointInPath(heroFly.x+heroFly.img.width/5/320*canvas.width/2,heroFly.y)||plane.isPointInPath(heroFly.x+26/320*canvas.width,heroFly.y+63/568*canvas.height)||plane.isPointInPath(heroFly.x+42/320*canvas.width,heroFly.y+63/568*canvas.height)||plane.isPointInPath(heroFly.x+10/320*canvas.width,heroFly.y+29/568*canvas.height)||plane.isPointInPath(heroFly.x+57/320*canvas.width,heroFly.y+29/568*canvas.height)||plane.isPointInPath(heroFly.x+1/320*canvas.width,heroFly.y+55/568*canvas.height)||plane.isPointInPath(heroFly.x+65/320*canvas.width,heroFly.y+55/568*canvas.height)||plane.isPointInPath(heroFly.x+12/320*canvas.width,heroFly.y+63/568*canvas.height)||plane.isPointInPath(heroFly.x+55/320*canvas.width,heroFly.y+63/568*canvas.height)){if(can==1){can=2;badfly[i].HP=0}}}if(can==2){canvas.removeEventListener("touchmove",ye);canvas.removeEventListener("touchstart",ye1);if(num%10==0){heroFly.b+=1;if(heroFly.b>=5){if(badfly.length==0&&gift0.length==0){bol=true}}}}for(var i=0;i<badfly.length;i+=1){badfly[i].draw()}if(can==1){if(num%8==0){heroFly.b=0}if(num%16==0){heroFly.b=1}}if(num%1500==0){if(can==1){var gifty=new gift();gift0.push(gifty)}}if(gift0.length>0){if(gift0[0].y>=canvas.height){gift0.splice(0)}}if(gift0.length>0){if(gift0[0].x<=0||gift0[0].x>=canvas.width-gift0[0].img.width/3/320*canvas.width){gift0[0].x1*=-1}gift0[0].y+=5;gift0[0].x+=gift0[0].x1}if(gift0.length>0){if(gift0[0].b==1){plane.beginPath();plane.rect(gift0[0].x,gift0[0].y+11/568*canvas.height,gift0[0].img.width/3/320*canvas.width,gift0[0].img.height/568*canvas.height-11/568*canvas.height);plane.closePath()}else{plane.beginPath();plane.rect(gift0[0].x,gift0[0].y,gift0[0].img.width/3/320*canvas.width,gift0[0].img.height/568*canvas.height);plane.closePath()}if(plane.isPointInPath(heroFly.x+heroFly.img.width/5/320*canvas.width/2,heroFly.y)||plane.isPointInPath(heroFly.x+26/320*canvas.width,heroFly.y+63/568*canvas.height)||plane.isPointInPath(heroFly.x+42/320*canvas.width,heroFly.y+63/568*canvas.height)||plane.isPointInPath(heroFly.x+10/320*canvas.width,heroFly.y+29/568*canvas.height)||plane.isPointInPath(heroFly.x+57/320*canvas.width,heroFly.y+29/568*canvas.height)||plane.isPointInPath(heroFly.x+1/320*canvas.width,heroFly.y+55/568*canvas.height)||plane.isPointInPath(heroFly.x+65/320*canvas.width,heroFly.y+55/568*canvas.height)||plane.isPointInPath(heroFly.x+12/320*canvas.width,heroFly.y+63/568*canvas.height)||plane.isPointInPath(heroFly.x+55/320*canvas.width,heroFly.y+63/568*canvas.height)){if(can==1){if(gift0[0].b==0){bombt+=1}else if(gift0[0].b==1){dan=0}else{bombt+=1;dan=0}gift0.splice(0)}}}if(gift0.length>0){gift0[0].draw()}heroFly.draw();plane.drawImage(storp,storp.width/320*canvas.width/2,storp.width/320*canvas.width/2,storp.width/320*canvas.width,storp.height/568*canvas.height);plane.drawImage(bomb,bomb.width/320*canvas.width*0.2,canvas.height-bomb.height/568*canvas.height*1.2,bomb.width/320*canvas.width,bomb.height/568*canvas.height);plane.textAlign="left";plane.font="8vw Microsoft YaHei";plane.fillStyle="rgb(117,122,123)";if(bombt<10){plane.fillText("×00"+bombt,bomb.width/320*canvas.width*1.2,canvas.height-bomb.height/568*canvas.height*0.45,500)}else if(bombt<100){plane.fillText("×0"+bombt,bomb.width/320*canvas.width*1.2,canvas.height-bomb.height/568*canvas.height*0.45,500)}else{plane.fillText("×0"+bombt,bomb.width/320*canvas.width*1.2,canvas.height-bomb.height/568*canvas.height*0.45,500)}plane.textAlign="right";plane.font="8vw Microsoft YaHei";plane.fillText("分数："+fen,canvas.width-10,50,canvas.width);if(bol){return}window.requestAnimationFrame(game)}function bg(){var bg=new Image();bg.src="img/bg.png";plane.drawImage(bg,0,bgheight,canvas.width,canvas.height);plane.drawImage(bg,0,-canvas.height+bgheight,canvas.width,canvas.height)}var enemy=["img/enemy1_fly.png","img/enemy2_fly.png","img/enemy3_fly.png"];function enemy_fly(){var g=Math.random();if(g<=0.6){var index=0}else if(g>0.6&&g<=0.95){var index=1}else{var index=2}var img=new Image();img.src=enemy[index];this.img=img;this.HP=index+index+1;this.speed=6-this.HP;this.y= -this.img.height/568*canvas.height;switch(index){case 0:this.die=5;break;case 1:this.die=6;break;case 2:this.die=10;break}this.b=0;this.x=rnd(0,canvas.width-this.img.width/this.die/320*canvas.width)}enemy_fly.prototype.draw=function(){plane.beginPath();plane.drawImage(this.img,this.img.width/this.die*this.b,0,this.img.width/this.die,this.img.height,this.x,this.y,this.img.width/this.die/320*canvas.width,this.img.height/568*canvas.height);plane.closePath()};function hero_fly(){var hero=new Image();hero.src="img/hero_fly.png";this.img=hero;this.x=canvas.width/2-this.img.width/5/320*canvas.width/2;this.y=canvas.height-this.img.height/568*canvas.height*2;this.b=0}hero_fly.prototype.draw=function(){plane.beginPath();plane.drawImage(this.img,this.img.width/5*this.b,0,this.img.width/5,this.img.height,this.x,this.y,this.img.width/5/320*canvas.width,this.img.height/568*canvas.height);plane.closePath()};canvas.addEventListener("touchmove",ye);var bullet1=new Image();bullet1.src="img/bullet1.png";var bullet2=new Image();bullet2.src="img/bullet3.png";function bullet(){this.img=bullet1;this.x=heroFly.x+heroFly.img.width/5/320*canvas.width/2-this.img.width/320*canvas.width/3;this.y=heroFly.y-this.img.height/568*canvas.height}bullet.prototype.draw=function(){plane.beginPath();plane.drawImage(this.img,this.x,this.y,this.img.width/320*canvas.width,this.img.height/568*canvas.height);plane.closePath()};canvas.addEventListener("touchstart",ye1);function ye1(event){if(event.changedTouches[0].clientX>=storp.width/320*canvas.width/2&&event.changedTouches[0].clientX<=storp.width/320*canvas.width/2+storp.width/320*canvas.width&&event.changedTouches[0].clientY>=storp.width/320*canvas.width/2&&event.changedTouches[0].clientY<=storp.width/320*canvas.width/2+storp.height/568*canvas.height){if(bol){bol=false;canvas.addEventListener("touchmove",ye);game()}else{canvas.removeEventListener("touchmove",ye);bol=true}}if(event.changedTouches[0].clientX>=bomb.width/320*canvas.width*0.2&&event.changedTouches[0].clientX<=bomb.width/320*canvas.width*1.2&&event.changedTouches[0].clientY>=canvas.height-bomb.height/568*canvas.height*1.2&&event.changedTouches[0].clientY<=canvas.height-bomb.height/568*canvas.height*0.2){if(bombt>0){for(var i=0;i<badfly.length;i+=1){badfly[i].HP=0}bombt-=1}}}function gift(){this.img=gi;this.x=rnd(0,canvas.width-this.img.width/3/320*canvas.width);this.y= -this.img.height/568*canvas.height;this.x1=rnd(0,1)>0?7:-7;this.b=rnd(0,2)}gift.prototype.draw=function(){plane.beginPath();plane.drawImage(this.img,this.img.width/3*this.b,0,this.img.width/3,this.img.height,this.x,this.y,this.img.width/3/320*canvas.width,this.img.height/568*canvas.height);plane.closePath()};